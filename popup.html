<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LLM Comparator</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="prompt-input">
      <textarea id="prompt" placeholder="Enter a prompt..."></textarea>
      <button id="send-button">✈️</button>
    </div>

    <div class="template-controls">
      <select id="template-select">
        <option value="">Select Template...</option>
      </select>
      <button id="close-template">Close Template</button>
      <button id="create-template">Create New</button>
    </div>

    <div class="variables-container" id="variables-container"></div>

    <div class="llm-selector">
      <label><input type="checkbox" name="llm" value="chatgpt" checked> ChatGPT</label>
      <label><input type="checkbox" name="llm" value="claude" checked> Claude</label>
      <label><input type="checkbox" name="llm" value="gemini" checked> Gemini</label>
      <label><input type="checkbox" name="llm" value="grok" checked> Grok</label>
      <label><input type="checkbox" name="llm" value="lechat" checked> Lechat</label>
      <label><input type="checkbox" name="llm" value="qwen" checked> Qwen</label>
      <label><input type="checkbox" name="llm" value="deepseek" checked> DeepSeek</label>
      <label><input type="checkbox" name="llm" value="perplex" checked> Perplex</label>
    
    </div>

    <div class="comparison-controls">
      <label><input type="checkbox" id="auto-checkbox" checked> Auto</label>
      <label><input type="checkbox" id="short-checkbox"> Short</label>
      <button id="get-it-button" disabled>Get it</button>
      <button id="compare-button" disabled>Compare</button>
    </div>

    <div class="responses-container">
      <div class="response-column" id="chatgpt-response">
        <h3>ChatGPT</h3>
        <div class="response-content"></div>
      </div>
      <div class="response-column" id="claude-response">
        <h3>Claude</h3>
        <div class="response-content"></div>
      </div>
      <div class="response-column" id="gemini-response">
        <h3>Gemini</h3>
        <div class="response-content"></div>
      </div>
      
      <div class="response-column" id="grok-response">
        <h3>Grok</h3>
        <div class="response-content"></div>
      </div>
      <div class="response-column" id="qwen-response">
        <h3>Qwen</h3>
        <div class="response-content"></div>
      </div>
      <div class="response-column" id="lechat-response">
        <h3>Lechat</h3>
        <div class="response-content"></div>
      </div>
      <div class="response-column" id="deepseek-response">
        <h3>DeepSeek</h3>
        <div class="response-content"></div>
      </div>
      <div class="response-column" id="perplexity-response">
        <h3>Perplexity</h3>
        <div class="response-content"></div>
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
  <!-- -- 1.1. Авто-вставка крестика очистки слева от "Use this response as prompt input" -- -->
<script>
(function() {
  function byText(root, tag, text) {
    const t = text.trim().toLowerCase();
    const els = root.querySelectorAll(tag);
    for (const el of els) {
      if ((el.textContent || '').trim().toLowerCase() === t) return el;
    }
    return null;
  }

  function createClearBtn() {
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'panel-action-btn clear-output-btn';
    btn.title = 'Очистить поле вывода';
    btn.setAttribute('aria-label', 'Очистить поле вывода');
    btn.textContent = '×';
    return btn;
  }

  function ensureClearBtn() {
    // 1) ищем контейнер кнопок возле вывода
    const wrap = document.querySelector('.output-actions, .output-footer') || document;
    // 2) ищем кнопку по видимому тексту
    const useBtn = byText(wrap, 'button', 'Use this response as prompt input');
    if (!useBtn) return;                       // ничего не делаем, если кнопка ещё не отрисована
    if (useBtn.previousElementSibling?.classList?.contains('clear-output-btn')) return;

    // 3) вставляем крестик слева
    useBtn.parentElement?.insertBefore(createClearBtn(), useBtn);
  }

  // первичная попытка + отслеживание динамического рендера
  document.addEventListener('DOMContentLoaded', ensureClearBtn);
  const mo = new MutationObserver(ensureClearBtn);
  mo.observe(document.documentElement, { childList: true, subtree: true });

  // делегированный обработчик очистки
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('.clear-output-btn');
    if (!btn) return;

    const ta = document.querySelector('.output-textarea');
    if (ta) {
      ta.value = '';
      ta.dispatchEvent(new Event('input', { bubbles: true }));
    }

    const ce = document.querySelector('[contenteditable][data-output], .output-content[contenteditable]');
    if (ce) {
      ce.textContent = '';
      ce.dispatchEvent(new Event('input', { bubbles: true }));
    }

    const box = document.querySelector('.output-container, .model-output, #output');
    if (box && !ta && !ce) box.textContent = '';
  });
})();
</script>

</body>
</html>