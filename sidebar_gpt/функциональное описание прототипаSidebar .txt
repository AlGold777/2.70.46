Полное функциональное описание прототипа (v56)
0) Общая концепция
Расширение — органайзер заметок с двухпанельным интерфейсом:
    • Sidebar (слева): tabs + дерево заметок + операции (создание, выбор, экспорт, удаление). 
    • Main (справа): просмотр/редактирование активной заметки. 
Дерево бесконечной вложенности. Все действия отражаются мгновенно, состояние хранится локально (persist).

1) Sidebar: Top area (Tabs + панель действий)
1.1 Tabs (как Chrome tabs)
Элементы:
    • Tabs: Home, Tab N... 
    • Кнопка + (добавить вкладку) 
Поведение:
    • Один клик по tab → активирует вкладку, рендерит её дерево заметок. 
    • Двойной клик по tab → режим inline-редактирования имени. 
    • В режиме редактирования справа появляется крестик закрытия tab. 
    • Клик по кресту → закрывает tab. 
    • При закрытии активного tab — активируется ближайший доступный. 
Сбросы при переключении tab:
    • Select All выключается. 
    • Мультивыделение очищается. 
    • Активная заметка сбрасывается/обновляется в рамках текущего tab. 
Нумерация:
    • Новые вкладки создаются как Tab 1, Tab 2... 

1.2 Search (поиск)
Назначение: фильтрация дерева по тексту заметок.
Поведение:
    • Ввод текста фильтрует заметки по подстроке (case-insensitive). 
    • Если совпадение находится внутри поддерева, показывается вся цепочка предков, чтобы результат был видимым. 
    • При фильтре отображаются только ветки, где есть совпадение в узле или потомках. 

1.3 Action row (слева направо)
    1. + Add Note (кнопка создания корневой заметки) 
    • Создаёт новую корневую заметку в текущем tab. 
    • Имя/текст: New N 
    • Вставляется сверху списка корневых заметок. 
    • Делает новую заметку активной (открывается справа). 
    1. Checkbox Select All 
    • По нажатию выделяет все заметки текущего tab: 
        ◦ корневые и всех потомков (даже если ветки свернуты). 
    • Повторное нажатие снимает выделение. 
    • При смене tab — автоматически выключается. 
    1. Кнопка </> Export selected to HTML 
    • Экспортирует выделенные заметки в HTML файл. 
    • Если выделение пустое — экспортирует активную заметку. 
    • Если выделены и родитель и ребёнок — экспортирует только top-most (чтобы не дублировать поддерево). 
    • Создаёт downloadable файл notes_export_<tab>_<timestamp>.html. 
    • Дополнительно пытается скопировать HTML в clipboard (best-effort). 
    1. 🗑️ Delete 
    • Если есть мультивыделение — удаляет выделенные (top-most) + их поддеревья. 
    • Если мультивыделения нет — удаляет активную заметку + её поддерево. 
    • После удаления: 
        ◦ очищает выделение, 
        ◦ сбрасывает Select All, 
        ◦ сохраняет состояние, 
        ◦ ререндерит дерево. 

2) Sidebar: Tree (дерево заметок)
2.1 Строка заметки (этикетка)
Содержит:
    • текст заметки (короткий заголовок из содержимого) 
    • маленькую кнопку + добавления дочерней заметки 
Клики:
    • Один клик → активирует заметку, отображает её содержимое в main. 
    • Двойной клик → разворачивает/сворачивает (toggle) дочерние узлы. 
2.2 “0 gap” визуальная стыковка
    • Между корневыми заметками — визуально нет “зазора”: убран двойной border (схлопывание линий). 
    • Между дочерними заметками — то же самое (схлопывание двойной линии внутри .children). 

3) Даты (группировка)
Заметки отображаются группами по дате создания (header над набором заметок):
    • Если дата = сегодня → Today 
    • Если дата = вчера → Yesterday 
    • Иначе → формат monDD (например dec22) 
Если несколько заметок созданы в один день — они идут под одним заголовком даты.

4) Создание заметок
4.1 Новая корневая заметка
    • + в action row 
    • имя: New N 
    • вставка сверху 
    • активируется 
4.2 Новая дочерняя заметка
    • + справа в строке заметки 
    • создаёт ребёнка, добавляет в children родителя 
    • имя: New N 
    • видимость зависит от expanded состояния родителя 

5) Drag & Drop заметок (внутри sidebar)
5.1 Drop на пустое место
    • заметка становится корневой 
5.2 Drop на другую заметку
    • заметка становится дочерней той, на которую сбросили 
5.3 Outdent жест “потянуть влево”
    • Во время drag заметки, если увести курсор влево от точки старта > порога, то при отпускании: 
        ◦ заметка поднимается на 1 уровень вверх (становится sibling родителя) 
        ◦ если у родителя нет родителя → станет корневой 
    • При срабатывании outdent жеста приоритет выше drop-цели (чтобы не было конфликтов). 
5.4 Инварианты
    • 1 родитель на узел. 
    • Нельзя создавать циклы (узел не может стать потомком самого себя/потомка). 
    • При перемещениях синхронно обновляются parents/children/roots. 

6) Main window (справа)
6.1
6.2 Editor
    • textarea с текстом активной заметки. 
    • Изменения обновляют state.notes[id].text. 
    • Сохранение делается с debounce (без спама persist). 

7) Drag текста из main → sidebar (копированием)
7.1 Источник
    • Пользователь выделяет текст в main editor. 
7.2 Важное правило
    • Текст не удаляется, а копируется для создания заметки. 
7.3 Drop варианты
    • Drop в пустое место sidebar → создаётся корневая заметка с этим текстом. 
    • Drop на заметку → она становится родителем, создаётся дочерняя заметка с этим текстом. 

8) Выделение заметок (multi-select)
8.1 Способы выделения
    1. Долгое удержание (long-press) по заметке → toggle selection. 
    2. Ctrl/⌘ + клик → toggle выделения конкретной заметки. 
    3. Shift + клик → выделение диапазона (range) от anchor до текущей. 
    4. Ctrl/⌘ + Shift + клик → добавление диапазона к уже выделенному (additive range). 
    5. при двойном клике на дате выделяются все заметки этой даты 
8.2 Anchor (точка диапазона)
    • При обычном клике anchor становится текущей заметкой. 
    • Shift-операции берут anchor и выделяют диапазон по видимому порядку строк дерева. 
8.3 Сброс
    • Esc очищает мультивыделение. 
    • При смене tab — мультивыделение очищается, чекбокс Select All выключается. 

9) Tree Keyboard Navigation (реальная навигация)
Работает, когда фокус в UI (и не в textarea редактирования).
9.1 Клавиши
    • ↑: предыдущая видимая заметка 
    • ↓: следующая видимая заметка 
    • ←: 
        ◦ если ветка раскрыта и есть дети → свернуть 
        ◦ иначе перейти к родителю 
    • →: 
        ◦ если ветка свернута и есть дети → раскрыть 
        ◦ иначе перейти к первому видимому ребёнку 
    • Enter: 
        ◦ toggle expand/collapse текущей заметки (если есть дети) 
9.2 Совместно с выделением
    • Shift + ↑/↓ расширяет/сужает диапазон выделения. 
    • Ctrl/⌘ позволяет не сбрасывать текущее выделение при перемещении (режим additive). 

10) Горячие клавиши операций
(Не срабатывают, если курсор в input/textarea)
    • Delete/Backspace: удалить выделенное (или активную, если выделения нет) 
    • Ctrl/⌘ + C: копировать выбранные заметки (прототипно) 
    • Ctrl/⌘ + X: вырезать выбранные (копия + удаление) 

11) Persist (хранение состояния)
    • Состояние хранится в localStorage. 
    • Persist вызывается после операций: 
        ◦ add/move/delete 
        ◦ rename tab 
        ◦ expand/collapse 
        ◦ изменение текста (debounce) 
        ◦ sort/search/resize (если присутствует) 

12) Экспорт в HTML (</>)
Экспортирует заметки как вложенные списки:
    • каждый узел: title + body 
    • вложенность соответствует дереву 
    • экспортирует top-most selection без дублей 
    • файл скачивается + best-effort копируется в clipboard 

13. Кнопка сворачивания и разворачивания side bar  - В левом верхнем углу  Главного окна приложение Слева от надписи Codex .

